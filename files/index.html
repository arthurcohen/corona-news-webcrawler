<html>
  <head>
   
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.4/css/responsive.bootstrap.min.css">

    <script
      type="text/javascript"
      language="javascript"
      src="https://code.jquery.com/jquery-3.5.1.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"
    ></script>
    <script
      src="https://cdn.rawgit.com/abdennour/react-csv/6424b500/cdn/react-csv-latest.min.js"
      type="text/javascript"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.11/jquery.csv.min.js"
      type="text/javascript"
    ></script>
    <script>
      $(document).ready(function () {
        if (
          window.File &&
          window.FileReader &&
          window.FileList &&
          window.Blob
        ) {
          document.getElementById("filetoRead").addEventListener(
            "change",
            function () {
              var file = this.files[0];

              if (file) {
                var reader = new FileReader();

                reader.onload = function (evt) {
                  console.log(evt);
                  var news = $.csv.toObjects(evt.target.result);
                  var newsRows = [];
                  news.forEach((element) => {
                    if (element.rank > 0 && element.read === "false") {
                      newsRows.push([
                        element.title + '	'+element.url+ '	'+element.imageUrl + '	'+element.sourceName+ '	'+ element.pubDate,
                        element.title,
                        element.url,
                        element.imageUrl,
                        element.sourceName,
                        element.pubDate,
                        element.rank,
                      ]);
                    }
                  });



                  var table =  $("#example").DataTable({
                    data: newsRows.sort((a, b) => b[6] - a[6]),
                    columns: [
                      { title: "Button" },
                      { title: "Title" },
                      { title: "Url" },
                      { title: "ImageURL" },
                      { title: "SourceName" },
                      { title: "pubDate" },
                      { title: "rank" },
                    ],
                    columnDefs: [
                        {
                            "targets": [ 3 ],
                            "visible": false,
                            "searchable": false
                        },
                        {
                            "targets": [ 4 ],
                            "visible": false,
                            "searchable": false
                        },{
                            "targets": [ 5 ],
                            "visible": false,
                            "searchable": false
                        },
                        {
                            "targets": [ 6 ],
                            "visible": false,
                            "searchable": false
                        },
                        {
                            "targets": [ 0 ],
                            "searchable": false,
                            "data": null,
                            "defaultContent": "<button>Copy</button>"
                        },
                    ]
                });

                $('#example tbody').on( 'click', 'button', async function () {
                       var data = table.row( $(this).parents('tr') ).data();
                       try {
                          await navigator.clipboard.writeText(data[0])
                          event.target.textContent = 'Copied to clipboard'
                        } catch (err) {
                          console.error('Failed to copy!', err)
                        }
                     } );
             };

                reader.onerror = function (evt) {
                  console.error("An error ocurred reading the file", evt);
                };

                reader.readAsText(file, "UTF-8");
              }
            },
            false
          );
        } else {
          alert("The File APIs are not fully supported by your browser.");
        }
      });
    </script>
  </head>

  <body>
    <p>
      Select a file from your computer to being read as text.
    </p>
    <input type="file" id="filetoRead" />
</br>
    <div class="col-sm-12">
        <table
        id="example"
        class="table table-striped table-bordered dt-responsive nowrap"
      ></table>
    </div>

  </body>
</html>
